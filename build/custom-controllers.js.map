{"version":3,"sources":["custom-controllers.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","InsuranceIinController","backend","$q","updateAvailable","vm","availableByPassengers","orderInfo","passengers","map","passenger","passengerNum","service","itemsByPassengers","nationalityCode","documentNumberDiscount","checkAdult","hasAdultKzWithIin","insuranceAvailable","hasAdultKz","some","age","moment","sessionParams","todayDate","diff","dateOfBirth","switchService","locked","active","items","modifyExtraService","getInsuranceSubmitParams","removeExtraService","onlineMode","switchServiceItem","itemNum","params","id","selected","then","iinFormTouched","saveIinHandlers","race","filter","handler","num","getInsuranceFullPrice","item","value","price","Big","insurance_premium","plus","luggage_premium","toFixed","currency","passenger_id","ins","tins","productCode","this","getOrderInfo","angular","component","templateUrl","controller","controllerAs","bindings","hasOtherServices","2","directive","iinUtils","scope","pax","link","elm","attrs","ctrl","validate","isValid","isValidIinForPax","gender","$setValidity","$error","customMessage","getAliasDynamic","$parsers","unshift","$formatters","3","PassengerIinFormController","$element","saveIin","submitTouched","resolve","reject","loading","iinForm","$valid","editableValue","modifyPassenger","additionalDocumentType","additionalDocumentNumber","index","onModify","$invalid","jQuery","triggerHandler","getIinDefaultValue","getIinStart","$onInit","addSaveIinHander","4","isRouteController","$scope","$location","$rootScope","onNewSearchResult","newSearchResult","brandsList","fareGroups","replaceFareGroups","_","forEach","flights","flight","flightInfo","destinationcity","origincity","waitUntilCompareTableOpen","setInterval","neededScope","findScopeWithProp","clearInterval","fareGroupDescriptionHTML","fareGroupDescription","replace","$apply","prop","currentScope","scopes","root","element","document","injector","get","pendingChildHeads","$$childHead","shift","hasOwnProperty","$id","push","$$nextSibling","$parent","originalBrands","needToRestoreBrandsInfo","ready","redefineRules","JSON","parse","getAlias","console","error","$watch","bind","searchResult","path","app","bindToController","scopeAs","5","./components/es-insurance-with-iin/es-insurance-with-iin","./components/iincheck/iincheck","./components/passenger-iin-form/passenger-iin-form","./directives/replaceWith","./screens/booking/BookingScreenController","./services/iinUtils","6","fancyboxTools","utils","redirect","submitPayment","paymentFormVariant","agree","modifyServicesLoading","orderServicesLoading","selectedPaymentForm","selectedPaymentType","findWhere","priceVariant","conflicts_with_aeroexpress","conflicts_with_insurance","openHandler","paymentForm","aeroexpress","insurance","submitCallback","submitPaymentHandler","all","getSaveIinHanders","groupedEditableExtraServices","cb","showNeedSelectPaymentFormMesage","removeInsuranceAeroexpress","doBookingAndRegisterOrderLoading","bookingError","doBookingAndRegisterOrder","card","resp","pnr","lastName","goToConfirmOrder","eraseAeroexpressBecauseOfCurrency","eraseInsuranceBecauseOfCurrency","mode","paymentFormChangeHandler","priceVariantItemCode","changePaymentForm","swithcSubmitButtonHoverState","submitButtonHover","$on","event","data","text","getAliasWithPrefix","clearOrderInfoListeners","clearUpdateOrderServicesListeners","addOrderInfoListener","header","regnum","addUpdateOrderServicesListener","isFreePricevariant","es","reformatAvailableExtraServices","esList","getAvailableExtraServicesList","getParam","hasBonusCard","ffpSumm","ffpBonus","total","errorMessage","updateOrderServices","switchDefaultSelectedServices","addExtraServiceListener","state","addExtraServiceErrorListener","req","modifyServicesError","7","factory","dateOfBirthMoment","format","getIinCenturyGenderCode","century","getCenturyByYear","year","yearBefore","Math","floor","getIinCheckSumm","iinStr","b","summ","split","scal","isValidIin","substr","A","B","result"],"mappings":"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","file":"custom-controllers.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('esInsuranceIin', {\n    templateUrl: 'components/es-insurance-with-iin/es-insurance-with-iin.html',\n    controller: ['backend', '$q', InsuranceIinController],\n    controllerAs: 'vm',\n    bindings: {\n        service: '=service',\n        locked: '=locked',\n        hasOtherServices: '='\n    }\n});\n\nfunction InsuranceIinController(backend, $q) {\n\n    var vm = this;\n\n    vm.switchService = switchService;\n    vm.switchServiceItem = switchServiceItem;\n    vm.getInsuranceFullPrice = getInsuranceFullPrice;\n    vm.updateAvailable = updateAvailable;\n    vm.saveIinHandlers = [];\n\n    vm.orderInfo = backend.getOrderInfo();\n\n    updateAvailable();\n\n    function updateAvailable() {\n\n        vm.availableByPassengers = vm.orderInfo.passengers.map(function (passenger, passengerNum) {\n            return (\n                vm.service.itemsByPassengers[passengerNum].length &&\n                passenger.nationalityCode === 'KZ' &&\n                passenger.documentNumberDiscount &&\n                (checkAdult(passenger) || hasAdultKzWithIin())\n            );\n        });\n\n        vm.insuranceAvailable = hasAdultKz();\n    }\n\n    function hasAdultKzWithIin() {\n        return vm.orderInfo.passengers.some(function (passenger) {\n            return (\n                checkAdult(passenger) &&\n                passenger.documentNumberDiscount &&\n                passenger.nationalityCode === 'KZ'\n            );\n        });\n    }\n\n    function hasAdultKz() {\n        return vm.orderInfo.passengers.some(function (passenger) {\n            return (\n                checkAdult(passenger) &&\n                passenger.nationalityCode === 'KZ'\n            );\n        });\n    }\n\n    function hasInternationalFlights() {\n        return vm.orderInfo.plainFlights.some(function (flight) {\n            var destinationCity = backend.getCityByCode(flight.destinationcity);\n            var originCity = backend.getCityByCode(flight.origincity);\n            return (\n                !destinationCity ||\n                !originCity ||\n                destinationCity.countryEn !== 'KZ' ||\n                originCity.countryEn !== 'KZ'\n            );\n        });\n    }\n\n    function checkAdult(passenger) {\n        var age = moment(backend.sessionParams.todayDate, 'DD.MM.YYYY').diff(\n            moment(passenger.dateOfBirth, 'DD.MM.YYYY'),\n            'years'\n        );\n        return age >= 18;\n    }\n\n    function switchService() {\n        if (!vm.locked) {\n            vm.service.active = !vm.service.active;\n            if (vm.service.active) {\n                if (vm.service.items.length === 1) {\n                    backend.modifyExtraService(getInsuranceSubmitParams(vm.service.items[0]));\n                }\n            } else {\n                backend.removeExtraService({\n                    code: vm.service.onlineMode ? 'insuranceOnline' : 'insurance'\n                });\n            }\n        }\n    }\n\n    function switchServiceItem(itemNum, passengerNum) {\n        var params = getInsuranceSubmitParams(\n            vm.service.itemsByPassengers[passengerNum][itemNum],\n            vm.orderInfo.passengers[passengerNum].id\n        );\n        if (!vm.locked) {\n            if (vm.service.itemsByPassengers[passengerNum][itemNum].selected) {\n                backend.removeExtraService(params).then(function () {\n                    vm.iinFormTouched[passengerNum] = false;\n                });\n            } else {\n                if (vm.orderInfo.passengers[passengerNum].documentNumberDiscount) {\n                    backend.modifyExtraService(params);\n                } else {\n                    if (checkAdult(vm.orderInfo.passengers[passengerNum]) || hasAdultKzWithIin()) {\n                        vm.saveIinHandlers[passengerNum]().then(function () {\n                            switchServiceItem(itemNum, passengerNum);\n                        });\n                    } else {\n                        $q.race(vm.saveIinHandlers.filter(function (handler, num) {\n                            return num !== passengerNum;\n                        }).map(function (handler) {\n                            return handler();\n                        })).then(function () {\n                            switchServiceItem(itemNum, passengerNum);\n                        });\n                    }\n\n                }\n            }\n        }\n    }\n\n    function getInsuranceFullPrice(item) {\n        return {\n            value: item.price || Big(item.insurance_premium || 0).plus(item.luggage_premium || 0).toFixed(2),\n            currency: item.currency\n        };\n    }\n\n    function getInsuranceSubmitParams(item, passenger_id) {\n        var params = {\n            code: 'insurance',\n            ins: item.ins,\n            tins: item.tins,\n            passenger_id: passenger_id\n        };\n        if (vm.service.onlineMode) {\n            params.code = 'insuranceOnline';\n            params.productCode = item.productCode;\n        }\n        return params;\n    }\n\n}\n\n},{}],2:[function(require,module,exports){\n\"use strict\";\nangular.module('app').directive('iincheck', ['iinUtils', 'backend', function (iinUtils, backend) {\n    return {\n        require: 'ngModel',\n        scope: {\n            pax: '=iincheck'\n        },\n        link: function (scope, elm, attrs, ctrl) {\n            if (!ctrl || !scope.pax) {\n                return;\n            }\n\n            ctrl.$parsers.unshift(validate);\n            ctrl.$formatters.unshift(validate);\n\n            function validate(value) {\n                var isValid = !value || iinUtils.isValidIinForPax(value, scope.pax.gender, scope.pax.dateOfBirth);\n                ctrl.$setValidity('iincheck', isValid);\n                if (isValid) {\n                    delete ctrl.$error.customMessage;\n                } else {\n                    ctrl.$error.customMessage = backend.getAliasDynamic('web.extraServices.insurance.invalidIinMessage');\n                }\n                \n                return value;\n            }\n        }\n    };\n}]);\n\n\n\n},{}],3:[function(require,module,exports){\n\"use strict\";\nangular.module('app').component('passengerIinForm', {\n    templateUrl: 'components/passenger-iin-form/passenger-iin-form.html',\n    controller: ['backend', 'iinUtils', '$q', '$element', PassengerIinFormController],\n    controllerAs: 'vm',\n    bindings: {\n        passenger: '=passenger',\n        num: '=num',\n        onModify: '&',\n        submitTouched: '=touched',\n        saveIin: '=?'\n    }\n});\n\nfunction PassengerIinFormController(backend, iinUtils, $q, $element) {\n\n    var vm = this;\n\n    vm.saveIin = saveIin;\n    vm.editableValue = getIinDefaultValue(vm.passenger);\n\n    vm.$onInit = function () {\n        iinUtils.addSaveIinHander(vm.saveIin, vm.num);\n    };\n    \n    function saveIin() {\n\n        vm.submitTouched = true;\n\n       return $q(function (resolve, reject) {\n\n            if (!vm.loading && vm.iinForm.$valid) {\n\n                if (vm.editableValue != vm.passenger.documentNumberDiscount) {\n\n                    vm.loading = true;\n\n                    backend.modifyPassenger({\n                        additionalDocumentType: 'ИИН',\n                        additionalDocumentNumber: vm.editableValue,\n                        index: vm.num\n                    }).then(function () {\n                        vm.loading = false;\n                        vm.passenger.documentNumberDiscount = vm.editableValue;\n                        vm.onModify();\n                        resolve();\n                    }, function () {\n                        vm.loading = false;\n                        reject();\n                    });\n\n                } else {\n                    resolve();\n                }\n\n            } else {\n                if (vm.iinForm.$invalid) {\n                    jQuery('form.iinForm__js.ng-invalid', $element).triggerHandler('submit');\n                }\n                reject();\n            }\n\n        });\n    }\n\n    function getIinDefaultValue(passenger) {\n        return passenger.documentNumberDiscount ? passenger.documentNumberDiscount : iinUtils.getIinStart(passenger.dateOfBirth, passenger.gender);\n    }        \n\n}\n},{}],4:[function(require,module,exports){\n\"use strict\";\n/*\n*\n* TODO: find the way to use this module without adding directive to component, if u can, remove search, search-order and add-services component\n*\n */\n\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', '$location', '$rootScope', isRouteController]);\n\nfunction isRouteController($scope, backend, $location, $rootScope) {\n    var vm = $scope.$parent.vm;\n    vm.originalBrands = false;\n    vm.needToRestoreBrandsInfo = false;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n        $scope.$watch(angular.bind(this, function () {\n            return vm.searchResult\n        }), function (newSearchResult) {\n\n            if ($location.path() === '/search-order') {\n                return;\n            }\n\n            onNewSearchResult(newSearchResult);\n        }, true);\n\n    });\n\n    function onNewSearchResult(newSearchResult) {\n        if (!newSearchResult.brandsList && newSearchResult.fareGroups) {\n            // fareGroups replace mode\n            replaceFareGroups(newSearchResult)\n        }\n    }\n\n\n    function replaceFareGroups(newSearchResult) {\n        _.forEach(newSearchResult.flights, function (flight) {\n            _.forEach(flight.flights, function (flightInfo) {\n                if (flightInfo.destinationcity === 'IST' || flightInfo.origincity === 'IST') {\n                    var waitUntilCompareTableOpen = setInterval(function () {\n                        var neededScope = findScopeWithProp($scope, 'fareGroupDescriptionHTML');\n                        if (neededScope) {\n                            clearInterval(waitUntilCompareTableOpen);\n                            neededScope.vm.fareGroupDescriptionHTML = neededScope.vm.fareGroupDescription.replace(/20 кг/gi, '30 кг');\n                            neededScope.$apply();\n                        }\n                    }, 200);\n                }\n            });\n        });\n    }\n\n    function findScopeWithProp(scope, prop) {\n        var scopes = {}; // exclude the current scope\n        var root = scope || angular.element(document).injector().get('$rootScope');\n        var pendingChildHeads = [root.$$childHead];\n        var currentScope;\n\n        while (pendingChildHeads.length) {\n            currentScope = pendingChildHeads.shift();\n\n            while (currentScope) {\n                if (currentScope.hasOwnProperty('vm')) {\n                    if (currentScope.vm[prop]) {\n                        return currentScope;\n                    }\n                }\n                scopes[\"scope\" + pendingChildHeads.length] = currentScope.$id;\n                pendingChildHeads.push(currentScope.$$childHead);\n                currentScope = currentScope.$$nextSibling;\n            }\n        }\n\n        return null;\n\n    }\n}\n},{}],5:[function(require,module,exports){\n\"use strict\";\nrequire('./components/es-insurance-with-iin/es-insurance-with-iin');\nrequire('./components/passenger-iin-form/passenger-iin-form');\nrequire('./components/iincheck/iincheck');\nrequire('./services/iinUtils');\nrequire('./screens/booking/BookingScreenController');\nrequire('./directives/replaceWith');\n\n},{\"./components/es-insurance-with-iin/es-insurance-with-iin\":1,\"./components/iincheck/iincheck\":2,\"./components/passenger-iin-form/passenger-iin-form\":3,\"./directives/replaceWith\":4,\"./screens/booking/BookingScreenController\":6,\"./services/iinUtils\":7}],6:[function(require,module,exports){\n\"use strict\";\nangular.module('app').controller(\n    'BookingScreenController',\n    ['$scope', 'fancyboxTools', 'backend', 'utils', 'redirect', 'iinUtils', '$q',\n    function ($scope, fancyboxTools, backend, utils, redirect, iinUtils, $q) {\n            const vm = this;\n\n            vm.loading = true;\n            vm.orderServicesLoading = true;\n\n            vm.submitPayment = submitPayment;\n            vm.paymentFormChangeHandler = paymentFormChangeHandler;\n            vm.swithcSubmitButtonHoverState = swithcSubmitButtonHoverState;\n\n            $scope.$on('plasticCardForPaymentChangeEvent', function (event, data) {\n                vm.card = data;\n            });\n\n            backend.ready.then(function() {\n                angular.element('title').text(backend.getAliasWithPrefix('web.pageTitle.', 'extraServices'));\n\n                backend.clearOrderInfoListeners();\n                backend.clearUpdateOrderServicesListeners();\n\n                backend.addOrderInfoListener(function(orderInfo) {\n                    if (orderInfo &&\n                        orderInfo.header &&\n                        orderInfo.header.regnum &&\n                        orderInfo.passengers &&\n                        orderInfo.passengers[0] &&\n                        orderInfo.passengers[0].lastName) {\n                        vm.loading = true;\n\n                        redirect.goToConfirmOrder();\n\n                        return;\n                    }\n\n                    vm.orderInfo = orderInfo;\n                });\n\n                backend.addUpdateOrderServicesListener(function(resp) {\n                    vm.orderInfo = resp[1];\n                    vm.priceVariant = resp[2];\n                    vm.isFreePricevariant = utils.isFreePricevariant(resp[2]);\n\n                    vm.es = utils.reformatAvailableExtraServices(resp[0], vm.orderInfo, vm.es);\n                    vm.esList = utils.getAvailableExtraServicesList(resp[0], vm.es);\n                    vm.loading = false;\n                    vm.orderServicesLoading = false;\n\n                    if (backend.getParam('ffp.enable') && (vm.orderInfo.hasBonusCard || vm.orderInfo.ffpSumm)) {\n                        backend.ffpBonus().then(function(resp) {\n                            vm.ffpBonus = resp.total || 0;\n                        });\n                    }\n\n                }, function(resp) {\n                    vm.loading = false;\n                    vm.orderServicesLoading = false;\n                    vm.errorMessage = resp.error;\n                });\n\n                backend.updateOrderServices(true).then(function() {\n                    backend.switchDefaultSelectedServices(vm.esList, vm.es, vm.orderInfo);\n                });\n\n                backend.addExtraServiceListener(function(state) {\n                    vm.modifyServicesLoading = !state;\n                    vm.orderServicesLoading = true;\n                });\n\n                backend.addExtraServiceErrorListener(function(resp, req) {\n                    if (!req || req.code !== 'seat') {\n                        vm.modifyServicesError = resp.error;\n                    }\n\n                    vm.modifyServicesLoading = false;\n                    vm.orderServicesLoading = true;\n                });\n\n            });\n\n            function submitPayment() {\n                var paymentFormVariant;\n\n                if (vm.agree && !vm.modifyServicesLoading && !vm.orderServicesLoading) {\n                    if (vm.selectedPaymentForm && vm.selectedPaymentType) {\n                        paymentFormVariant = _.findWhere(vm.priceVariant, { code: vm.selectedPaymentForm });\n                        if (paymentFormVariant.conflicts_with_aeroexpress ||\n                            paymentFormVariant.conflicts_with_insurance) {\n                            fancyboxTools.openHandler('popupCancelConflictServices', false, {\n                                paymentForm: vm.selectedPaymentForm,\n                                aeroexpress: paymentFormVariant.conflicts_with_aeroexpress,\n                                insurance: paymentFormVariant.conflicts_with_insurance,\n                                submitCallback: submitPaymentHandler\n                            });\n                        } else {\n                            $q.all(iinUtils.getSaveIinHanders().filter(function (handler, passengerNum) {\n                                return (\n                                    vm.orderInfo &&\n                                    vm.orderInfo.groupedEditableExtraServices &&\n                                    vm.orderInfo.groupedEditableExtraServices.insurance &&\n                                    !!vm.orderInfo.groupedEditableExtraServices.insurance[passengerNum]\n                                );\n                            }).map(function (cb) {\n                                return cb();\n                            })).then(function () {\n                                submitPaymentHandler();\n                            });\n\n                        }\n\n                    } else {\n                        vm.showNeedSelectPaymentFormMesage = true;\n                    }\n                }\n            }\n\n            function submitPaymentHandler(removeInsuranceAeroexpress) {\n                vm.doBookingAndRegisterOrderLoading = true;\n\n                if (vm.bookingError) {\n                    delete vm.bookingError;\n                }\n\n                backend.doBookingAndRegisterOrder(vm.selectedPaymentForm, vm.selectedPaymentType,\n                    removeInsuranceAeroexpress, vm.card).then(function(resp) {\n                    if (resp.pnr && resp.lastName) {\n                        redirect.goToConfirmOrder();\n                    } else if (resp.eraseAeroexpressBecauseOfCurrency || resp.eraseInsuranceBecauseOfCurrency) {\n                        fancyboxTools.openHandler('popupChangeCurrencyError', false, {\n                            eraseAeroexpressBecauseOfCurrency: resp.eraseAeroexpressBecauseOfCurrency,\n                            eraseInsuranceBecauseOfCurrency: resp.eraseInsuranceBecauseOfCurrency,\n                            mode: 'booking',\n                            submitCallback: submitPaymentHandler\n                        });\n                    }\n\n                    vm.doBookingAndRegisterOrderLoading = false;\n                }, function(resp) {\n                    vm.doBookingAndRegisterOrderLoading = false;\n                    vm.bookingError = resp.error;\n                });\n            }\n\n            function paymentFormChangeHandler(priceVariantItemCode) {\n                vm.showNeedSelectPaymentFormMesage = false;\n                backend.changePaymentForm(priceVariantItemCode);\n            }\n\n            function swithcSubmitButtonHoverState() {\n                vm.submitButtonHover = !vm.submitButtonHover;\n            }\n\n        }\n    ]\n);\n\n\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\nangular.module('app').factory('iinUtils', [\n    function () {\n\n        var saveIinHandlers = [];\n\n        return {\n            getIinStart: getIinStart,\n            getIinCenturyGenderCode: getIinCenturyGenderCode,\n            getCenturyByYear: getCenturyByYear,\n            getIinCheckSumm: getIinCheckSumm,\n            isValidIin: isValidIin,\n            isValidIinForPax: isValidIinForPax,\n            addSaveIinHander: addSaveIinHander,\n            getSaveIinHanders: getSaveIinHanders\n        };\n\n        function getIinStart(dateOfBirth, gender) {\n            var dateOfBirthMoment = moment(dateOfBirth, 'DD.MM.YYYY');\n            return dateOfBirthMoment.format('YYMMDD') + getIinCenturyGenderCode(dateOfBirthMoment, gender);\n        }\n    \n        function getIinCenturyGenderCode(dateOfBirthMoment, gender) {\n            var century = getCenturyByYear(dateOfBirthMoment.year());\n            if (gender === 'male') {\n                if (century === 19) return '1';\n                else if (century === 20) return '3';\n                else if (century === 21) return '5';\n            } else if (gender === 'female') {\n                if (century === 19) return '2';\n                else if (century === 20) return '4';\n                else if (century === 21) return '6';\n            }\n            return '';\n        }\n    \n        function getCenturyByYear(year) {\n            var yearBefore = year - 1;\n            return Math.floor(yearBefore/100) + 1;\n        }\n\n        function getIinCheckSumm(iinStr) {\n            var a, b, summ;\n            if (iinStr && iinStr.length === 11) {\n                a = iinStr.split('');\n                b = [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 ];\n                summ = scal(a, b) % 11;\n                if (summ === 10) {\n                    b = [ 3, 4, 5, 6, 7, 8, 9, 10, 11, 1, 2 ];\n                    summ = scal(a, b) % 11;\n                }\n                if (summ >= 0 && summ <= 9) {\n                    return summ;\n                }\n            }\n            return -1;\n        }\n\n        function isValidIin(iinStr) {\n            if (iinStr && iinStr.length === 12) {\n                if (\n                    moment(iinStr.substr(0, 6), 'YYMMDD').isValid() &&\n                    getIinCheckSumm(iinStr.substr(0, 11)) == iinStr[11]\n                ) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        function isValidIinForPax(iinStr, gender, dateOfBirth) {\n            return (iinStr.substr(0, 7) === getIinStart(dateOfBirth, gender) && isValidIin(iinStr))\n        }\n\n        function scal(A, B) {\n            var result = 0;\n            if (A && B && A.length === B.length) {\n                for (var i=0; i<A.length; i++) {\n                    result += A[i] * B[i];\n                }\n                return result;\n            }\n        }\n\n        function addSaveIinHander(cb, num) {\n            saveIinHandlers[num] = cb;\n        }\n\n        function getSaveIinHanders() {\n            return saveIinHandlers;\n        }\n\n    }\n]);\n},{}]},{},[5]);\n"]}