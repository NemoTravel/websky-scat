!function(){function e(n,i,r){function t(s,u){if(!i[s]){if(!n[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var l=i[s]={exports:{}};n[s][0].call(l.exports,function(e){var i=n[s][1][e];return t(i||e)},l,l.exports,e,n,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)t(r[s]);return t}return e}()({1:[function(e,n,i){"use strict";function r(e,n){function i(){f.availableByPassengers=f.orderInfo.passengers.map(function(e,n){return f.service.itemsByPassengers[n].length&&"KZ"===e.nationalityCode&&e.documentNumberDiscount&&(s(e)||r())}),f.insuranceAvailable=t()&&!o()}function r(){return f.orderInfo.passengers.some(function(e){return s(e)&&e.documentNumberDiscount&&"KZ"===e.nationalityCode})}function t(){return f.orderInfo.passengers.some(function(e){return s(e)&&"KZ"===e.nationalityCode})}function o(){return f.orderInfo.plainFlights.some(function(n){var i=e.getCityByCode(n.destinationcity),r=e.getCityByCode(n.origincity);return!i||!r||"KZ"!==i.countryEn||"KZ"!==r.countryEn})}function s(n){var i=moment(e.sessionParams.todayDate,"DD.MM.YYYY").diff(moment(n.dateOfBirth,"DD.MM.YYYY"),"years");return i>=18}function u(){f.locked||(f.service.active=!f.service.active,f.service.active?1===f.service.items.length&&e.modifyExtraService(l(f.service.items[0])):e.removeExtraService({code:f.service.onlineMode?"insuranceOnline":"insurance"}))}function c(i,t){f.locked||(f.orderInfo.passengers[t].documentNumberDiscount?e[f.service.itemsByPassengers[t][i].selected?"removeExtraService":"modifyExtraService"](l(f.service.itemsByPassengers[t][i],f.orderInfo.passengers[t].id)):s(f.orderInfo.passengers[t])||r()?f.saveIinHandlers[t]().then(function(){c(i,t)}):n.race(f.saveIinHandlers.filter(function(e,n){return n!==t}).map(function(e){return e()})).then(function(){c(i,t)}))}function a(e){return{value:e.price||Big(e.insurance_premium||0).plus(e.luggage_premium||0).toFixed(2),currency:e.currency}}function l(e,n){var i={code:"insurance",ins:e.ins,tins:e.tins,passenger_id:n};return f.service.onlineMode&&(i.code="insuranceOnline",i.productCode=e.productCode),i}var f=this;f.switchService=u,f.switchServiceItem=c,f.getInsuranceFullPrice=a,f.updateAvailable=i,f.saveIinHandlers=[],f.orderInfo=e.getOrderInfo(),i()}angular.module("app").component("esInsuranceIin",{templateUrl:"components/es-insurance-with-iin/es-insurance-with-iin.html",controller:["backend","$q",r],controllerAs:"vm",bindings:{service:"=service",locked:"=locked",hasOtherServices:"="}})},{}],2:[function(e,n,i){"use strict";angular.module("app").directive("iincheck",["iinUtils","backend",function(e,n){return{require:"ngModel",scope:{pax:"=iincheck"},link:function(i,r,t,o){function s(r){var t=!r||e.isValidIinForPax(r,i.pax.gender,i.pax.dateOfBirth);return o.$setValidity("iincheck",t),t?delete o.$error.customMessage:o.$error.customMessage=n.getAliasDynamic("web.extraServices.insurance.invalidIinMessage"),r}o&&i.pax&&(o.$parsers.unshift(s),o.$formatters.unshift(s))}}}])},{}],3:[function(e,n,i){"use strict";function r(e,n,i){function r(){return o.submitTouched=!0,i(function(n,i){!o.loading&&o.iinForm.$valid&&o.editableValue!=o.passenger.documentNumberDiscount?(o.loading=!0,e.modifyPassenger({additionalDocumentType:"ИИН",additionalDocumentNumber:o.editableValue,index:o.num}).then(function(){o.loading=!1,o.passenger.documentNumberDiscount=o.editableValue,o.onModify(),n()},function(){o.loading=!1,i()})):(o.iinForm.$invalid&&jQuery("form.iinForm__js.ng-invalid").triggerHandler("submit"),i())})}function t(e){return e.documentNumberDiscount?e.documentNumberDiscount:n.getIinStart(e.dateOfBirth,e.gender)}var o=this;o.saveIin=r,o.editableValue=t(o.passenger)}angular.module("app").component("passengerIinForm",{templateUrl:"components/passenger-iin-form/passenger-iin-form.html",controller:["backend","iinUtils","$q",r],controllerAs:"vm",bindings:{passenger:"=passenger",num:"=num",onModify:"&",saveIin:"=?"}})},{}],4:[function(e,n,i){"use strict";e("./components/es-insurance-with-iin/es-insurance-with-iin"),e("./components/passenger-iin-form/passenger-iin-form"),e("./components/iincheck/iincheck"),e("./services/iinUtils")},{"./components/es-insurance-with-iin/es-insurance-with-iin":1,"./components/iincheck/iincheck":2,"./components/passenger-iin-form/passenger-iin-form":3,"./services/iinUtils":5}],5:[function(e,n,i){"use strict";angular.module("app").factory("iinUtils",[function(){function e(e,i){var r=moment(e,"DD.MM.YYYY");return r.format("YYMMDD")+n(r,i)}function n(e,n){var r=i(e.year());if("male"===n){if(19===r)return"1";if(20===r)return"3";if(21===r)return"5"}else if("female"===n){if(19===r)return"2";if(20===r)return"4";if(21===r)return"6"}return""}function i(e){var n=e-1;return Math.floor(n/100)+1}function r(e){var n,i,r;return e&&11===e.length&&(n=e.split(""),i=[1,2,3,4,5,6,7,8,9,10,11],r=s(n,i)%11,10===r&&(i=[3,4,5,6,7,8,9,10,11,1,2],r=s(n,i)%11),r>=0&&9>=r)?r:-1}function t(e){return e&&12===e.length&&moment(e.substr(0,6),"YYMMDD").isValid()&&r(e.substr(0,11))==e[11]?!0:!1}function o(n,i,r){return n.substr(0,7)===e(r,i)&&t(n)}function s(e,n){var i=0;if(e&&n&&e.length===n.length){for(var r=0;r<e.length;r++)i+=e[r]*n[r];return i}}return{getIinStart:e,getIinCenturyGenderCode:n,getCenturyByYear:i,getIinCheckSumm:r,isValidIin:t,isValidIinForPax:o}}])},{}]},{},[4]);
//# sourceMappingURL=custom-controllers.js.map
